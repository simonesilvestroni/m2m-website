<section class="related-posts my-5 pt-3">

  <h3 class="mt-0 mb-4 py-2">See also</h3>

  <ul class="m2m-ul">

  {%- assign maxRelated = 3 --%}
  {%- assign minCommonTags =  1 --%}
  {%- assign maxRelatedCounter = 0 --%}

  {%- for post in site.posts -%}

    {%- assign sameTagCount = 0 --%}
    {%- assign commonTags = '' --%}

    {%- for tag in post.tags -%}
      {%- if post.url != page.url -%}
        {%- if page.tags contains tag -%}
          {%- assign sameTagCount = sameTagCount | plus: 1 -%}
          {%- capture tagmarkup -%} <span class="label label-default">{{ tag }}</span> {%- endcapture -%}
          {%- assign commonTags = commonTags | append: tagmarkup -%}
        {%- endif -%}
      {%- endif -%}
    {%- endfor -%}

    {%- if sameTagCount >= minCommonTags -%}
   
    <li class="fs-5"><a href="{{ post.url }}" title="Read: {{ post.title }}">{{ post.title }}</a></li>

    {%- assign maxRelatedCounter = maxRelatedCounter | plus: 1 --%}

    {%- if maxRelatedCounter >= maxRelated -%}
      {%- break -%}
    {%- endif -%}
  {%- endif -%}

  {%- endfor -%}

  </ul>

</section>