<section class="related-posts my-5 pt-3">

  <h3 class="h2 text-center mt-0 mb-4 px-3 py-2 rounded">You May Also Enjoy</h3>

  <div class="card-group">
    <div class="row row-cols-1 row-cols-sm-2 row-cols-lg-3 g-4">

{%- assign maxRelated = 3 --%}
{%- assign minCommonTags =  1 --%}
{%- assign maxRelatedCounter = 0 --%}

{%- for post in site.posts -%}

  {%- assign sameTagCount = 0 --%}
  {%- assign commonTags = '' --%}

  {%- for tag in post.tags -%}
    {%- if post.url != page.url -%}
      {%- if page.tags contains tag -%}
        {%- assign sameTagCount = sameTagCount | plus: 1 -%}
        {%- capture tagmarkup -%} <span class="label label-default">{{ tag }}</span> {%- endcapture -%}
        {%- assign commonTags = commonTags | append: tagmarkup -%}
      {%- endif -%}
    {%- endif -%}
  {%- endfor -%}

  {%- if sameTagCount >= minCommonTags -%}
   
    <div class="col m2m-transition-opacity-03s">
      <div class="card h-100 m2m-transition-border-03s">
        <div class="card-body">
          <h4 class="small text-uppercase mb-3">{{ post.title }}</h4>
          <p class="card-text m2m-sans small">{{ post.excerpt | strip_html }}</p>
        </div>
        <div class="card-footer text-center pb-3">
          <a class="stretched-link" href="{{ post.url }}" title="Read: {{ post.title }}">Read the post</a> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/></svg>
        </div>
      </div>
    </div>

  {%- assign maxRelatedCounter = maxRelatedCounter | plus: 1 --%}

    {%- if maxRelatedCounter >= maxRelated -%}
      {%- break -%}
    {%- endif -%}
  {%- endif -%}

{%- endfor -%}
  </div>
</div>

</section>