(function(){"use strict";window.i18next=window.i18next||{t:function t(key){return key}};const t=window.i18next.t.bind(window.i18next);function getCfg(key,dfl){return document.currentScript.getAttribute("data-"+key)||dfl}const refurl=getCfg("page-url",window.location.href.replace(/#.*$/,""));const addurls=getCfg("add-urls",undefined);const containerID=getCfg("id","webmentions");const textMaxWords=getCfg("wordcount");const maxWebmentions=getCfg("max-webmentions",1200);const mentionSource=getCfg("prevent-spoofing")?"wm-source":"url";const sortBy=getCfg("sort-by","published");const sortDir=getCfg("sort-dir","up");const commentsAreReactions=getCfg("comments-are-reactions");const reactTitle={"in-reply-to":t("replied"),"like-of":t("liked"),"repost-of":t("reposted"),"bookmark-of":t("bookmarked"),"mention-of":t("mentioned"),"rsvp":t("RSVPed"),"follow-of":t("followed")};const reactEmoji={"in-reply-to":"","like-of":"‚ù§Ô∏è","repost-of":"üîÑ","bookmark-of":"‚≠êÔ∏è","mention-of":"üí¨","rsvp":"üìÖ","follow-of":"üêú"};const rsvpEmoji={"yes":"‚úÖ","no":"‚ùå","interested":"üí°","maybe":"üí≠"};function entities(text){return text.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function reactImage(r,isComment){const who=entities(r.author?.name??r.url.split("/")[2]);let response=reactTitle[r["wm-property"]]||t("reacted");if(!isComment&&r.content&&r.content.text){response+=": "+extractComment(r)}let authorPhoto='';if(r.author&&r.author.photo){authorPhoto=`
        <img
          src="${entities(r.author.photo)}"
          loading="lazy"
          decoding="async"
          alt="${who}"
        >
      `}let rsvp='';if(r.rsvp&&rsvpEmoji[r.rsvp]){rsvp=`<sub>${rsvpEmoji[r.rsvp]}</sub>`}return`
      <a
        class="reaction"
        rel="nofollow ugc"
        title="${who} ${response}"
        href="${r[mentionSource]}"
      >
        ${authorPhoto}
        ${(reactEmoji[r['wm-property']]||'')}
        ${rsvp}
      </a>
    `}function stripurl(url){return url.substr(url.indexOf('//'))}function dedupe(mentions){const filtered=[];const seen={};mentions.forEach(function(r){const source=stripurl(r.url);if(!seen[source]){filtered.push(r);seen[source]=true}});return filtered}function extractComment(c){let text=entities(c.content.text);if(textMaxWords){let words=text.replace(/\s+/g,' ').split(' ',textMaxWords+1);if(words.length>textMaxWords){words[textMaxWords-1]+='&hellip;';words=words.slice(0,textMaxWords);text=words.join(' ')}}return text}function formatComments(comments){const headline=`<h2>${t('Webmentions')}</h2>`;const markup=comments.map((c)=>{const image=reactImage(c,true);let source=entities(c.url.split('/')[2]);if(c.author&&c.author.name){source=entities(c.author.name)}const link=`<a class="source" rel="nofollow ugc" href="${c[mentionSource]}">${source}</a>`;let linkclass="name";let linktext=`(${t("mention")})`;if(c.name){linkclass="name";linktext=c.name}else if(c.content&&c.content.text){linkclass="text";linktext=extractComment(c)}const type=`<span class="${linkclass}">${linktext}</span>`;return`<li>${image} ${link} ${type}</li>`}).join('');return`
      ${headline}
      <ul class="comments">${markup}</ul>
    `}function formatReactions(reacts){const headline=`<h2>${t('Reactions')}</h2>`;const markup=reacts.map((r)=>reactImage(r)).join('');return`
      ${headline}
      <ul class="reacts">${markup}</ul>
    `}window.addEventListener("load",async function(){const container=document.getElementById(containerID);if(!container){return}const pages=[stripurl(refurl)];if(!!addurls){addurls.split('|').forEach(function(url){pages.push(stripurl(url))})}let apiURL=`https://webmention.io/api/mentions.jf2?per-page=${maxWebmentions}&sort-by=${sortBy}&sort-dir=${sortDir}`;pages.forEach(function(path){apiURL+=`&target[]=${encodeURIComponent('http:'+path)}&target[]=${encodeURIComponent('https:'+path)}`});let json={};try{const response=await window.fetch(apiURL);if(response.status>=200&&response.status<300){json=await response.json()}else{console.error("Could not parse response");new Error(response.statusText)}}catch(error){console.error("Request failed",error)}let comments=[];const collects=[];if(commentsAreReactions){comments=collects}const mapping={"in-reply-to":comments,"like-of":collects,"repost-of":collects,"bookmark-of":collects,"follow-of":collects,"mention-of":comments,"rsvp":comments};json.children.forEach(function(child){const store=mapping[child['wm-property']];if(store){store.push(child)}});let formattedComments='';if(comments.length>0&&comments!==collects){formattedComments=formatComments(dedupe(comments))}let reactions='';if(collects.length>0){reactions=formatReactions(dedupe(collects))}container.innerHTML=`${formattedComments}${reactions}`})}());